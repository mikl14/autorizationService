# Домашнее задание 4/5: AuthorizationService

## Описание проекта

Простой **сервис авторизации пользователей**, реализованный с использованием Spring Boot, Spring Data JPA и JWT (JSON Web Tokens). Предназначен для управления доступом пользователей с тремя ролями:

- **GUEST**  
- **PREMIUM_USER**  
- **ADMIN**  

JWT токены имеют время жизни 5 минут. При наличии валидного токена в заголовке запроса пользователю предоставляется доступ к API-эндпоинтам согласно его роли.

## Доступные API эндпоинты

| Путь                    | Описание                                                          | Доступно для ролей         |
|-------------------------|-------------------------------------------------------------------|----------------------------|
| `/api/auth/index`        | Общий доступ                                                      | GUEST, PREMIUM_USER, ADMIN |
| `/api/auth/premium`      | Доступ для премиум пользователей                                 | PREMIUM_USER, ADMIN        |
| `/api/auth/admin`        | Админский доступ                                                 | ADMIN                      |
| `/api/auth/register`     | Регистрация новых пользователей                                  | Доступен без авторизации   |
| `/api/auth/login`        | Вход пользователя и получение JWT токена                         | Доступен без авторизации   |
| `/api/auth/refreshtoken` | Обновление JWT и Refresh токена без повторного ввода логина и пароля | Доступен с refresh токеном |
| `/api/auth/logout`       | Выход пользователя, отзыв JWT токена (занесение его в чёрный список) | Доступен с JWT токеном     |

Администратор имеет доступ ко всем доменам.

## Форматы запросов

### Регистрация

`POST /api/auth/register`

Тело запроса (JSON):

{
"username": "user",
"email": "ros@example.ru",
"password": "password",
"role": "GUEST"
}


### Вход (логин)

`POST /api/auth/login`

Тело запроса (JSON):
{
"username": "user",
"password": "password"
}


### Обновление токенов (Refresh token)

`POST /api/auth/refreshtoken`

При запросе пользователь отправляет в теле свой refresh токен. Сервис проверяет его и, если валиден, выдает новый JWT токен и новый refresh токен.  
Refresh токен обновляется при каждом использовании для повышения безопасности и также хранится в базе данных.

### Выход (logout)

`POST /api/auth/logout`

Запрос с действующим JWT токеном в заголовке, который будет отозван — добавлен в чёрный список в Redis с TTL, равным оставшемуся времени жизни токена.

### Авторизация по токену

Для доступа к защищённым эндпоинтам необходимо передавать JWT токен в заголовке:

Authorization: Bearer <JWT_TOKEN>


## Важные детали реализации

- Пароли пользователей **хранятся в базе данных PostgreSQL** в зашифрованном виде. Шифрование пароля происходит уже на сервере при сохранении, так как клиент передаёт пароль в открытом виде (в тз не было, поэтому я и не стал додумывать).
- В сервисе реализован механизм использования **refresh токенов** — они сохраняются в базе и позволяют пользователям обновлять JWT токены без повторного ввода логина и пароля.
- Для работы с базой используется **Spring Data JPA**.
- Реализован отзыв токенов: при отзыве JWT токен заносится в **черный список в Redis** с временем жизни, равным оставшемуся времени жизни токена. Это позволяет эффективно блокировать действующие токены.
- В проекте намеренно оставлен файл `application.properties` для удобства проверки.

## Используемые технологии

- Java 17
- Spring Boot
- Spring Data JPA
- PostgreSQL
- Redis (для черного списка токенов)
- JWT с временем жизни 5 минут

---

## Запуск и тестирование

1. Сконфигурировать подключение к базе PostgreSQL и Redis в `application.properties`.
2. Запустить приложение стандартным способом:

